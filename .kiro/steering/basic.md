---
inclusion: always
---

## 基本的な開発ガイドライン

### 言語とコミュニケーション規則

- **必須**: すべてのコメント、ドキュメント、仕様書は日本語で記述する
- **必須**: JSDoc コメントは日本語で記述し、関数の目的と引数を明記する
- **推奨**: 変数名・関数名は英語、説明文は日本語を使用する

### TypeScript & コード品質

- **必須**: `any`型は絶対に使用しない - `unknown`または適切な型を定義する
- **必須**: strict モードを維持し、型エラーは必ず解決する
- **必須**: Zod スキーマから型を推論する（`z.infer<typeof schema>`）
- **必須**: 関数には戻り値の型を明示的に指定する
- **推奨**: ESLint 警告は可能な限り解決する

### ファイル構成パターン

- **API Routes**: `app/api/` - 外部統合のみ、内部ロジックは`lib/services/`に配置
- **Server Actions**: `lib/actions/` - データ変更操作用
- **Components**: `app/_components/features/[domain]/` - ドメイン別に整理
- **Types**: `lib/types/` - Prisma スキーマから生成、手動定義は最小限
- **Validations**: `lib/validations/` - Zod スキーマを配置

### データベース & セキュリティ

- **必須**: Prisma 経由でのみデータベースアクセスを行う
- **必須**: ユーザー入力は処理前に Zod で検証する
- **必須**: Supabase RLS ポリシーでデータアクセスを制御する
- **禁止**: `.env`ファイルの直接変更 - `.env.example`を参照する
- **必須**: 機密データは環境変数に保存し、コードに直接記述しない

### React & Next.js パターン

- **デフォルト**: Server Components を使用する
- **例外**: インタラクティブ機能が必要な場合のみ`'use client'`を追加
- **必須**: `cn()`ユーティリティを使用して Tailwind クラスを結合する
- **推奨**: shadcn/ui コンポーネントパターンに従う
- **必須**: SWR を使用してデータフェッチとキャッシュを管理する

### エラーハンドリング

- **必須**: `lib/errors/`のカスタムエラークラスを使用する
- **必須**: API レスポンスは構造化されたエラー形式を返す
- **必須**: ユーザー向けエラーメッセージは日本語で表示する
- **推奨**: Sonner トーストでユーザーフィードバックを提供する

### パフォーマンス要件

- **必須**: データベースクエリで N+1 問題を回避する
- **推奨**: 画像とアセットを最適化する
- **推奨**: 大きなコンポーネントは適切に分割する
- **必須**: 不要な再レンダリングを避けるため useCallback と useMemo を適切に使用する
